crystal_doc_search_index_callback({"repository_name":"Likee Scrapepr","body":"# Likee Scraper\n\n![Unit Tests](https://github.com/kandayo/likee-scraper/workflows/Unit%20Tests/badge.svg)\n![Integration Tests](https://github.com/kandayo/likee-scraper/workflows/Integration%20Tests/badge.svg)\n[![GitHub release](https://img.shields.io/github/release/kandayo/likee-scraper.svg?label=Release)](https://github.com/kandayo/likee-scraper/releases)\n\nDownload videos (and their metadata) from Likee.\n\nThe videos are downloaded in their original quality, with no watermark.\n\nSee also: [**Likee API Wrapper**](https://github.com/kandayo/likee.cr).\n\n## Index\n\n- [Features](#features)\n- [Disclaimer](#disclaimer)\n- [Installation](#installation)\n- [Usage](#usage)\n  - [Download profile by @username](#download-profile-by-username)\n  - [Download profile by ID](#download-profile-by-id)\n  - [Batch file](#batch-file)\n  - [Fast update](#fast-update)\n- [Contributing](#contributing)\n- [Contributors](#contributors)\n\n## Features\n\n<p align=\"center\">\n  <img src=\"https://user-images.githubusercontent.com/43556511/108448057-ee8f7680-7258-11eb-90bd-7f253b3d0b4f.png\" alt=\"Terminalizer\">\n</p>\n\n- Download profiles by @username.\n- Download profiles by User ID.\n- Built for archivists in mind: smart fast update.\n- Extract metadata from entities.\n- Batch file, cronjob friendly.\n\n## Disclaimer\n\nThis app is in no way affiliated with, authorized, maintained or endorsed by\nLikee or any of its affiliates or subsidiaries.\n\nThis is purely an educational proof of concept.\n\n## Installation\n\n### From source\n\n1. Clone the repository:\n\n```bash\ngit clone https://github.com/kandayo/likee-scraper\n```\n\n2. Compile the binary in release mode:\n\n```bash\ncd likee-scraper\nshards build --release\n```\n\n3. Move the binary to your PATH or use it right away:\n\n```bash\n./bin/likeer --help\n```\n\n## Usage\n\nFor more examples, please refer to the [**documentation**](https://absolab.xyz/likee-scraper).\n\n### Download profile by @username\n\nLooking up a user by username requires an additional API request. It's strongly\nrecommended to use User IDs. Usernames must be prefixed with an `@`.\n\n```bash\n$ likeer -u @username\n```\n\n### Download profile by ID\n\nIf a identifier does not have a prefix, it is assumed to be an User ID.\n\n```bash\n$ likeer -u 11111111\n```\n\n### Batch file\n\nIf `--batch-file <file.txt>` (or `-a`) is given, Likee will read *file.txt*\nexpecting @usernames and User IDs to download, one identifier per line.\nLines starting with \"#\" or empty lines are considered as comments and ignored.\n\nUsernames must be prefixed with an `@`, e.g. `@username`.\n\nIDs must not be prefixed with an `@`, e.g. `1111111`.\n\n```bash\n$ cat batch.txt\n~> # Comment (ignored)\n~> @username\n~> 111111111\n$ likeer -a batch.txt\n```\n\n### Fast update\n\nIf `--fast-update` (or `-f`) is given, Likeer stops when arriving at the\nfirst already downloaded video. This flag is recommended when you use Likeer\nto update your personal archive.\n\n```bash\n$ likeer -u @username -f\n# => Example Username - 000003.mp4 [========================] 12.1 MB / 12.1 MB\n# => Example Username - 000002.mp4; skipping\n# => User @username in sync!\n```\n\n## Contributing\n\n1. Fork it (<https://github.com/kandayo/likee-scraper/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n\n## Contributors\n\n- [kandayo](https://github.com/kandayo) - creator and maintainer\n","program":{"html_id":"Likee Scrapepr/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"Likee Scrapepr","program":true,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"Likee Scrapepr/Likee","path":"Likee.html","kind":"module","full_name":"Likee","name":"Likee","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"lib/likee/src/likee.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/lib/likee/src/likee.cr#L3"},{"filename":"lib/likee/src/likee/client.cr","line_number":8,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/lib/likee/src/likee/client.cr#L8"},{"filename":"lib/likee/src/likee/client/activity_flow_endpoints.cr","line_number":1,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/lib/likee/src/likee/client/activity_flow_endpoints.cr#L1"},{"filename":"lib/likee/src/likee/concepts/likee_response.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/lib/likee/src/likee/concepts/likee_response.cr#L3"},{"filename":"lib/likee/src/likee/concepts/user_posts_count.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/lib/likee/src/likee/concepts/user_posts_count.cr#L3"},{"filename":"lib/likee/src/likee/concepts/video.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/lib/likee/src/likee/concepts/video.cr#L3"},{"filename":"lib/likee/src/likee/exceptions.cr","line_number":4,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/lib/likee/src/likee/exceptions.cr#L4"},{"filename":"lib/likee/src/likee/utils.cr","line_number":1,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/lib/likee/src/likee/utils.cr#L1"},{"filename":"lib/likee/src/likee/version.cr","line_number":1,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/lib/likee/src/likee/version.cr#L1"},{"filename":"src/likee_scraper/ext/likee/video.cr","line_number":1,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/ext/likee/video.cr#L1"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[{"html_id":"Likee Scrapepr/Likee/Client","kind":"module","full_name":"Likee::Client","name":"Client"}],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"Likee Scrapepr/Likee/Video","path":"Likee/Video.html","kind":"struct","full_name":"Likee::Video","name":"Video","abstract":false,"superclass":{"html_id":"Likee Scrapepr/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"Likee Scrapepr/JSON/Serializable/Unmapped","kind":"module","full_name":"JSON::Serializable::Unmapped","name":"Unmapped"},{"html_id":"Likee Scrapepr/JSON/Serializable","kind":"module","full_name":"JSON::Serializable","name":"Serializable"},{"html_id":"Likee Scrapepr/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Likee Scrapepr/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Likee Scrapepr/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"lib/likee/src/likee/concepts/video.cr","line_number":8,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/lib/likee/src/likee/concepts/video.cr#L8"},{"filename":"src/likee_scraper/ext/likee/video.cr","line_number":2,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/ext/likee/video.cr#L2"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[{"html_id":"Likee Scrapepr/JSON/Serializable","kind":"module","full_name":"JSON::Serializable","name":"Serializable"},{"html_id":"Likee Scrapepr/JSON/Serializable/Unmapped","kind":"module","full_name":"JSON::Serializable::Unmapped","name":"Unmapped"}],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scrapepr/Likee","kind":"module","full_name":"Likee","name":"Likee"},"doc":"The `Video` structure represents a Likee video.\n\nThe JSON payload returned by the API call is parsed and transformed to a\nstable interface.","summary":"<p>The <code><a href=\"../Likee/Video.html\">Video</a></code> structure represents a Likee video.</p>","class_methods":[],"constructors":[],"instance_methods":[{"id":"filename:String-instance-method","html_id":"filename:String-instance-method","name":"filename","doc":"Returns the filename without the extension.","summary":"<p>Returns the filename without the extension.</p>","abstract":false,"args":[],"args_string":" : String","args_html":" : String","location":{"filename":"src/likee_scraper/ext/likee/video.cr","line_number":4,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/ext/likee/video.cr#L4"},"def":{"name":"filename","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"formatted_timestamp = uploaded_at.to_utc.to_s(\"%Y-%m-%d %T\")\n\"#{formatted_timestamp} - #{id}\"\n"}},{"id":"secure_url:String-instance-method","html_id":"secure_url:String-instance-method","name":"secure_url","doc":"Returns the HTTPs download url.\nEnsures that the client downloads the `Video` over HTTPs.","summary":"<p>Returns the HTTPs download url.</p>","abstract":false,"args":[],"args_string":" : String","args_html":" : String","location":{"filename":"src/likee_scraper/ext/likee/video.cr","line_number":11,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/ext/likee/video.cr#L11"},"def":{"name":"secure_url","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"if download_url.starts_with?(\"http://\")\nelse\n  return download_url\nend\ndownload_url.sub(/^http:/, \"https:\")\n"}}],"macros":[],"types":[]}]},{"html_id":"Likee Scrapepr/LikeeScraper","path":"LikeeScraper.html","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"src/cli/cli.cr","line_number":5,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/cli/cli.cr#L5"},{"filename":"src/cli/cli/file_reader.cr","line_number":1,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/cli/cli/file_reader.cr#L1"},{"filename":"src/likee_scraper.cr","line_number":4,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper.cr#L4"},{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/exceptions/http_error.cr#L3"},{"filename":"src/likee_scraper/exceptions/user_not_found_error.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/exceptions/user_not_found_error.cr#L3"},{"filename":"src/likee_scraper/logger.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/logger.cr#L3"},{"filename":"src/likee_scraper/user_profile/username_normalizer.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/user_profile/username_normalizer.cr#L3"},{"filename":"src/likee_scraper/user_profile/video_collector.cr","line_number":1,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/user_profile/video_collector.cr#L1"},{"filename":"src/likee_scraper/user_profile/video_downloader.cr","line_number":5,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/user_profile/video_downloader.cr#L5"},{"filename":"src/likee_scraper/utils.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/utils.cr#L3"},{"filename":"src/likee_scraper/version.cr","line_number":1,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/version.cr#L1"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"\"0.2.0\"","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[{"id":"download_user(username_or_id:String,fast_update=false):Nil-class-method","html_id":"download_user(username_or_id:String,fast_update=false):Nil-class-method","name":"download_user","doc":null,"summary":null,"abstract":false,"args":[{"name":"username_or_id","doc":null,"default_value":"","external_name":"username_or_id","restriction":"String"},{"name":"fast_update","doc":null,"default_value":"false","external_name":"fast_update","restriction":""}],"args_string":"(username_or_id : String, fast_update = <span class=\"n\">false</span>) : Nil","args_html":"(username_or_id : String, fast_update = <span class=\"n\">false</span>) : Nil","location":{"filename":"src/likee_scraper.cr","line_number":5,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper.cr#L5"},"def":{"name":"download_user","args":[{"name":"username_or_id","doc":null,"default_value":"","external_name":"username_or_id","restriction":"String"},{"name":"fast_update","doc":null,"default_value":"false","external_name":"fast_update","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"user_id = (UsernameNormalizer.new(username_or_id)).call\nif user_id.nil?\n  Log.error do\n    \"🚩 User not found: #{username_or_id}\"\n  end\n  return\nend\nVideoCollector.collect_each(user_id: user_id) do |video|\n  downloaded = (VideoDownloader.new(video)).call\n  if fast_update && (!downloaded)\n    Log.info do\n      \"✅ User #{username_or_id} in sync!\"\n    end\n    return\n  end\nend\n"}},{"id":"download_users(users=[]ofString,fast_update=false):Nil-class-method","html_id":"download_users(users=[]ofString,fast_update=false):Nil-class-method","name":"download_users","doc":null,"summary":null,"abstract":false,"args":[{"name":"users","doc":null,"default_value":"[] of String","external_name":"users","restriction":""},{"name":"fast_update","doc":null,"default_value":"false","external_name":"fast_update","restriction":""}],"args_string":"(users = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, fast_update = <span class=\"n\">false</span>) : Nil","args_html":"(users = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, fast_update = <span class=\"n\">false</span>) : Nil","location":{"filename":"src/likee_scraper.cr","line_number":23,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper.cr#L23"},"def":{"name":"download_users","args":[{"name":"users","doc":null,"default_value":"[] of String","external_name":"users","restriction":""},{"name":"fast_update","doc":null,"default_value":"false","external_name":"fast_update","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"users.each do |username_or_id|\n  Log.info do\n    \"Collecting videos from profile #{username_or_id}.\"\n  end\n  download_user(username_or_id, fast_update: fast_update)\nend"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"Likee Scrapepr/LikeeScraper/CLI","path":"LikeeScraper/CLI.html","kind":"module","full_name":"LikeeScraper::CLI","name":"CLI","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"src/cli/cli.cr","line_number":6,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/cli/cli.cr#L6"},{"filename":"src/cli/cli/file_reader.cr","line_number":2,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/cli/cli/file_reader.cr#L2"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scrapepr/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":null,"summary":null,"class_methods":[{"id":"run:Nil-class-method","html_id":"run:Nil-class-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Nil","args_html":" : Nil","location":{"filename":"src/cli/cli.cr","line_number":7,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/cli/cli.cr#L7"},"def":{"name":"run","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"fast_update = false\nusernames_or_user_ids = [] of String\nparsed = OptionParser.parse do |parser|\n  parser.banner = \"Usage: likeer [arguments]\"\n  parser.on(\"-u @USERNAME⠀or⠀ID\", \"--user @USERNAME⠀or⠀ID\", \"Download all videos (and their metadata) published by the given user.\\n» Username: @Likee_USA (starts with a '@')\\n» ID: 3007\\n\") do |value|\n    usernames_or_user_ids << value.strip\n  end\n  parser.on(\"-a FILE\", \"--batch-file FILE\", \"File containing IDs or @usernames to download, one ID per line.\\nEmpty lines or lines starting with '#' are considered as comments\\nand ignored.\\n\") do |value|\n    extracted_ids = FileProcessor.call(value)\n    if extracted_ids\n      usernames_or_user_ids = usernames_or_user_ids + extracted_ids\n    else\n      STDERR.puts(\"No such file or directory: #{value}\")\n      exit(1)\n    end\n  end\n  parser.on(\"-f\", \"--fast-update\", \"Stop when encountering the first already-downloaded video.\\nThis flag is recommended when you use Likeer to update your personal\\narchive.\\n\") do\n    fast_update = true\n  end\n  parser.on(\"-v\", \"--version\", \"Show the version number and exit.\") do\n    puts(VERSION)\n    exit(0)\n  end\n  parser.on(\"-h\", \"--help\", \"Show this help message and exit.\") do\n    puts(parser)\n    exit(0)\n  end\n  parser.missing_option do |flag|\n    STDERR.puts(\"ERROR: #{flag} flag expects a argument\\n\\n\")\n    STDERR.puts(parser)\n    exit(1)\n  end\n  parser.invalid_option do |flag|\n    STDERR.puts(\"ERROR: #{flag} is not a valid option.\\n\\n\")\n    STDERR.puts(parser)\n    exit(1)\n  end\nend\nif usernames_or_user_ids.empty?\n  STDERR.puts(\"ERROR: Missing target user(s).\\n\\n\")\n  STDERR.puts(parsed)\n  exit(1)\nend\nLikeeScraper.download_users(usernames_or_user_ids, fast_update: fast_update)\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"Likee Scrapepr/LikeeScraper/CLI/FileProcessor","path":"LikeeScraper/CLI/FileProcessor.html","kind":"class","full_name":"LikeeScraper::CLI::FileProcessor","name":"FileProcessor","abstract":false,"superclass":{"html_id":"Likee Scrapepr/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Likee Scrapepr/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Likee Scrapepr/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/cli/cli/file_reader.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/cli/cli/file_reader.cr#L3"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scrapepr/LikeeScraper/CLI","kind":"module","full_name":"LikeeScraper::CLI","name":"CLI"},"doc":null,"summary":null,"class_methods":[{"id":"call(file:String):Array(String)?-class-method","html_id":"call(file:String):Array(String)?-class-method","name":"call","doc":null,"summary":null,"abstract":false,"args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"String"}],"args_string":"(file : String) : Array(String)?","args_html":"(file : String) : Array(String)?","location":{"filename":"src/cli/cli/file_reader.cr","line_number":4,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/cli/cli/file_reader.cr#L4"},"def":{"name":"call","args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Array(String) | ::Nil","visibility":"Public","body":"if File.exists?(file)\nelse\n  return\nend\nids = [] of String\nFile.each_line(file) do |line|\n  if line.empty?\n    next\n  end\n  if (line.starts_with?(/\\s/)) || (line.starts_with?(\"#\"))\n    next\n  end\n  ids << line.strip\nend\nids\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]}]},{"html_id":"Likee Scrapepr/LikeeScraper/HTTPError","path":"LikeeScraper/HTTPError.html","kind":"class","full_name":"LikeeScraper::HTTPError","name":"HTTPError","abstract":false,"superclass":{"html_id":"Likee Scrapepr/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"Likee Scrapepr/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"Likee Scrapepr/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Likee Scrapepr/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":6,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/exceptions/http_error.cr#L6"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scrapepr/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":"The `HTTPError` exception is raised when the HTTP status is not between\n200 and 299.","summary":"<p>The <code><a href=\"../LikeeScraper/HTTPError.html\">HTTPError</a></code> exception is raised when the HTTP status is not between 200 and 299.</p>","class_methods":[],"constructors":[{"id":"new(response)-class-method","html_id":"new(response)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"response","doc":null,"default_value":"","external_name":"response","restriction":""}],"args_string":"(response)","args_html":"(response)","location":{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":11,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/exceptions/http_error.cr#L11"},"def":{"name":"new","args":[{"name":"response","doc":null,"default_value":"","external_name":"response","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(response)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"message:String-instance-method","html_id":"message:String-instance-method","name":"message","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","args_html":" : String","location":{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":14,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/exceptions/http_error.cr#L14"},"def":{"name":"message","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"\"HTTP status code #{status.code}: #{status.description}\""}},{"id":"response:HTTP::Client::Response-instance-method","html_id":"response:HTTP::Client::Response-instance-method","name":"response","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : HTTP::Client::Response","args_html":" : HTTP::Client::Response","location":{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":9,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/exceptions/http_error.cr#L9"},"def":{"name":"response","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"HTTP::Client::Response","visibility":"Public","body":"@response"}},{"id":"status(*args,**options)-instance-method","html_id":"status(*args,**options)-instance-method","name":"status","doc":null,"summary":null,"abstract":false,"args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","location":{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":7,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/exceptions/http_error.cr#L7"},"def":{"name":"status","args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"double_splat":{"name":"options","doc":null,"default_value":"","external_name":"options","restriction":""},"splat_index":0,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"response.status(*args, **options)"}},{"id":"status(*args,**options,&)-instance-method","html_id":"status(*args,**options,&)-instance-method","name":"status","doc":null,"summary":null,"abstract":false,"args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","location":{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":7,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/exceptions/http_error.cr#L7"},"def":{"name":"status","args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"double_splat":{"name":"options","doc":null,"default_value":"","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arg":null,"return_type":"","visibility":"Public","body":"response.status(*args, **options) do |*yield_args|\n  yield *yield_args\nend"}}],"macros":[],"types":[]},{"html_id":"Likee Scrapepr/LikeeScraper/LikeeLogger","path":"LikeeScraper/LikeeLogger.html","kind":"struct","full_name":"LikeeScraper::LikeeLogger","name":"LikeeLogger","abstract":false,"superclass":{"html_id":"Likee Scrapepr/Log/StaticFormatter","kind":"struct","full_name":"Log::StaticFormatter","name":"StaticFormatter"},"ancestors":[{"html_id":"Likee Scrapepr/Log/StaticFormatter","kind":"struct","full_name":"Log::StaticFormatter","name":"StaticFormatter"},{"html_id":"Likee Scrapepr/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"Likee Scrapepr/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"Likee Scrapepr/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/likee_scraper/logger.cr","line_number":4,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/logger.cr#L4"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scrapepr/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"run:IO-instance-method","html_id":"run:IO-instance-method","name":"run","doc":"Subclasses must implement this method to define the output pattern","summary":"<p>Subclasses must implement this method to define the output pattern</p>","abstract":false,"args":[],"args_string":" : IO","args_html":" : IO","location":{"filename":"src/likee_scraper/logger.cr","line_number":5,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/logger.cr#L5"},"def":{"name":"run","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"IO","visibility":"Public","body":"message"}}],"macros":[],"types":[]},{"html_id":"Likee Scrapepr/LikeeScraper/UsernameNormalizer","path":"LikeeScraper/UsernameNormalizer.html","kind":"class","full_name":"LikeeScraper::UsernameNormalizer","name":"UsernameNormalizer","abstract":false,"superclass":{"html_id":"Likee Scrapepr/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Likee Scrapepr/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Likee Scrapepr/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/likee_scraper/user_profile/username_normalizer.cr","line_number":4,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/user_profile/username_normalizer.cr#L4"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"BASE_URL","name":"BASE_URL","value":"\"https://likee.video\"","doc":null,"summary":null},{"id":"USER_AGENT","name":"USER_AGENT","value":"\"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\"","doc":null,"summary":null},{"id":"USER_ID_REGEX","name":"USER_ID_REGEX","value":"/likevideo\\:\\/\\/profile\\?uid\\=(?<user_id>\\d+)/","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scrapepr/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(identifier:String)-class-method","html_id":"new(identifier:String)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"identifier","doc":null,"default_value":"","external_name":"identifier","restriction":"String"}],"args_string":"(identifier : String)","args_html":"(identifier : String)","location":{"filename":"src/likee_scraper/user_profile/username_normalizer.cr","line_number":11,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/user_profile/username_normalizer.cr#L11"},"def":{"name":"new","args":[{"name":"identifier","doc":null,"default_value":"","external_name":"identifier","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(identifier)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"call:String?-instance-method","html_id":"call:String?-instance-method","name":"call","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String?","args_html":" : String?","location":{"filename":"src/likee_scraper/user_profile/username_normalizer.cr","line_number":15,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/user_profile/username_normalizer.cr#L15"},"def":{"name":"call","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String | ::Nil","visibility":"Public","body":"if @identifier.starts_with?(\"@\")\nelse\n  return @identifier\nend\nresponse = @client.get(\"/user/#{@identifier}/amp\")\nif response.success?\nelse\n  return\nend\nif match = response.body.match(USER_ID_REGEX)\n  match[\"user_id\"]\nend\n"}}],"macros":[],"types":[]},{"html_id":"Likee Scrapepr/LikeeScraper/UserNotFoundError","path":"LikeeScraper/UserNotFoundError.html","kind":"class","full_name":"LikeeScraper::UserNotFoundError","name":"UserNotFoundError","abstract":false,"superclass":{"html_id":"Likee Scrapepr/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"Likee Scrapepr/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"Likee Scrapepr/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Likee Scrapepr/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/likee_scraper/exceptions/user_not_found_error.cr","line_number":7,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/exceptions/user_not_found_error.cr#L7"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scrapepr/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":"The `UserNotFoundError` exception is raised if the given user could not\nbe found. It usually means that the target username or user_id is\ninvalid.","summary":"<p>The <code><a href=\"../LikeeScraper/UserNotFoundError.html\">UserNotFoundError</a></code> exception is raised if the given user could not be found.</p>","class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"Likee Scrapepr/LikeeScraper/Utils","path":"LikeeScraper/Utils.html","kind":"module","full_name":"LikeeScraper::Utils","name":"Utils","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"src/likee_scraper/utils.cr","line_number":5,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/utils.cr#L5"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scrapepr/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":"The `Utils` module defines multiple helpers.","summary":"<p>The <code><a href=\"../LikeeScraper/Utils.html\">Utils</a></code> module defines multiple helpers.</p>","class_methods":[{"id":"retry_on_connection_error(&)-class-method","html_id":"retry_on_connection_error(&)-class-method","name":"retry_on_connection_error","doc":"Retries the *&block* when a connection error or a Likee API error occurs.","summary":"<p>Retries the <em>&block</em> when a connection error or a Likee API error occurs.</p>","abstract":false,"args":[],"args_string":"(&)","args_html":"(&)","location":{"filename":"src/likee_scraper/utils.cr","line_number":7,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/utils.cr#L7"},"def":{"name":"retry_on_connection_error","args":[],"double_splat":null,"splat_index":null,"yields":0,"block_arg":null,"return_type":"","visibility":"Public","body":"on_retry_callback = ->(_ex : Exception, attempt : Int32, _elapsed_time : Time::Span, _next_interval : Time::Span) do\n  Log.error do\n    \"An error occoured while fetching posts; retring (#{attempt}/5)...\"\n  end\nend\nRetriable.retry(on: {IO::TimeoutError, Errno::ECONNRESET, Likee::RequestFailedError, Likee::APIError, HTTPError}, on_retry: on_retry_callback, intervals: Array.new(5, 5.seconds)) do\n  yield\nend\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"Likee Scrapepr/LikeeScraper/VideoCollector","path":"LikeeScraper/VideoCollector.html","kind":"module","full_name":"LikeeScraper::VideoCollector","name":"VideoCollector","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"src/likee_scraper/user_profile/video_collector.cr","line_number":4,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/user_profile/video_collector.cr#L4"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"MAX_VIDEOS_PER_PAGE","name":"MAX_VIDEOS_PER_PAGE","value":"100","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scrapepr/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":"The `VideoCollector` module defines the interaction with the Likee API\nto fetch videos from the user profile.","summary":"<p>The <code><a href=\"../LikeeScraper/VideoCollector.html\">VideoCollector</a></code> module defines the interaction with the Likee API to fetch videos from the user profile.</p>","class_methods":[{"id":"collect_each(user_id:String,last_post_id:String=&quot;&quot;,&)-class-method","html_id":"collect_each(user_id:String,last_post_id:String=&quot;&quot;,&)-class-method","name":"collect_each","doc":"Yields each video from the user profile. It iterates through all pages\nfrom the newest video to the oldest video.","summary":"<p>Yields each video from the user profile.</p>","abstract":false,"args":[{"name":"user_id","doc":null,"default_value":"","external_name":"user_id","restriction":"String"},{"name":"last_post_id","doc":null,"default_value":"\"\"","external_name":"last_post_id","restriction":"String"}],"args_string":"(user_id : String, last_post_id : String = <span class=\"s\">&quot;&quot;</span>, &)","args_html":"(user_id : String, last_post_id : String = <span class=\"s\">&quot;&quot;</span>, &)","location":{"filename":"src/likee_scraper/user_profile/video_collector.cr","line_number":9,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/user_profile/video_collector.cr#L9"},"def":{"name":"collect_each","args":[{"name":"user_id","doc":null,"default_value":"","external_name":"user_id","restriction":"String"},{"name":"last_post_id","doc":null,"default_value":"\"\"","external_name":"last_post_id","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":null,"return_type":"","visibility":"Public","body":"loop do\n  collection = Utils.retry_on_connection_error do\n    Likee.user_videos(user_id: user_id, last_post_id: last_post_id, limit: MAX_VIDEOS_PER_PAGE)\n  end\n  if collection.empty?\n    break\n  end\n  last_post_id = collection.last.id\n  collection.each do |video|\n    yield video\n  end\nend"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"Likee Scrapepr/LikeeScraper/VideoDownloader","path":"LikeeScraper/VideoDownloader.html","kind":"class","full_name":"LikeeScraper::VideoDownloader","name":"VideoDownloader","abstract":false,"superclass":{"html_id":"Likee Scrapepr/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Likee Scrapepr/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Likee Scrapepr/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/likee_scraper/user_profile/video_downloader.cr","line_number":6,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/user_profile/video_downloader.cr#L6"}],"repository_name":"Likee Scrapepr","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"Log","name":"Log","value":"::Log.for(\"Downloader\")","doc":null,"summary":null},{"id":"PROGRESS_BAR_SIZE","name":"PROGRESS_BAR_SIZE","value":"30","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scrapepr/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(video:Likee::Video)-class-method","html_id":"new(video:Likee::Video)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"video","doc":null,"default_value":"","external_name":"video","restriction":"Likee::Video"}],"args_string":"(video : Likee::Video)","args_html":"(video : <a href=\"../Likee/Video.html\">Likee::Video</a>)","location":{"filename":"src/likee_scraper/user_profile/video_downloader.cr","line_number":11,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/user_profile/video_downloader.cr#L11"},"def":{"name":"new","args":[{"name":"video","doc":null,"default_value":"","external_name":"video","restriction":"Likee::Video"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(video)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"call:Bool-instance-method","html_id":"call:Bool-instance-method","name":"call","doc":"Downloads a `Likee::Video`. The video is initially saved to a temporary\nfile, then it's moved to its definitive location.","summary":"<p>Downloads a <code><a href=\"../Likee/Video.html\">Likee::Video</a></code>.</p>","abstract":false,"args":[],"args_string":" : Bool","args_html":" : Bool","location":{"filename":"src/likee_scraper/user_profile/video_downloader.cr","line_number":17,"url":"https://github.com/kandayo/likee-scraper/blob/34e73f7259779165375a59f9c28c74a7bc9a5e18/src/likee_scraper/user_profile/video_downloader.cr#L17"},"def":{"name":"call","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Bool","visibility":"Public","body":"begin\n  File.write(metadata_destination, @video.to_pretty_json)\n  if File.exists?(destination)\n    Log.info do\n      \"#{@video.creator_nickname} — #{@video.id}.mp4; skipping\"\n    end\n    return false\n  end\n  Utils.retry_on_connection_error do\n    HTTP::Client.get(@video.secure_url, headers: headers) do |response|\n      if response.success?\n      else\n        raise(HTTPError.new(response))\n      end\n      file_size = response.headers[\"Content-Length\"].to_u64 do\n        0_u64\n      end\n      File.open(temp_destination, \"w\") do |file|\n        buffer = uninitialized ::StaticArray(UInt8, 4096)\n        progress = 0_u64\n        while (len = (response.body_io.read(buffer.to_slice)).to_i32) > 0\n          file.write(buffer.to_slice[0, len])\n          progress = progress &+ len\n          print_progress(file_size, progress)\n        end\n      end\n    end\n  end\n  FileUtils.mv(temp_destination, destination)\n  true\nrescue IO::TimeoutError | HTTPError\n  Log.error do\n    \"Retries exausted: #{@video.secure_url}; skipping\"\n  end\n  true\nend"}}],"macros":[],"types":[]}]}]}})