{"repository_name":"Likeer","body":"# Likeer\n\n![Unit Tests](https://github.com/kandayo/likee-scraper/workflows/Unit%20Tests/badge.svg)\n![Integration Tests](https://github.com/kandayo/likee-scraper/workflows/Integration%20Tests/badge.svg)\n[![GitHub release](https://img.shields.io/github/release/kandayo/likee-scraper.svg?label=Release)](https://github.com/kandayo/likee-scraper/releases)\n\nDownload videos **without watermark** from Likee.\n\n**Work in progress, but decently usable.**\n\nSee also: [**Likee.cr - Unofficial Likee API wrapper for Crystal**](https://github.com/kandayo/likee.cr).\n\n## Disclaimer\n\nThis app is in no way affiliated with, authorized, maintained or endorsed by\nLikee or any of its affiliates or subsidiaries.\n\nThis is purely an educational proof of concept.\n\n## Installation\n\n### From source\n\n1. Clone the repository:\n\n```bash\ngit clone https://github.com/kandayo/likee-scraper\n```\n\n2. Compile the binary in release mode:\n\n```bash\ncd likee-scraper\nshards build --release\n```\n\n3. Move the binary to your PATH or use it right away:\n\n```bash\n./bin/likeer --help\n```\n\n## Usage\n\nFor more examples, please refer to the [**documentation**](https://kandayo.github.io/likee-scraper/Likeer.html).\n\n```bash\n# Archive the user feed, but stop when encountering the first already-downloaded post.\n# Note: this is the default behaviour.\nlikeer store --fast-update <USER>\n\n# Archive the last 5 posts of <USER>.\nlikeer store -n 5 <USER>\n```\n\n## Contributing\n\n1. Fork it (<https://github.com/kandayo/likee-scraper/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n\n## Contributors\n\n- [kandayo](https://github.com/kandayo) - creator and maintainer\n","program":{"html_id":"Likeer/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"Likeer","program":true,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"Likeer/Likeer","path":"Likeer.html","kind":"module","full_name":"Likeer","name":"Likeer","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"src/cli/cli.cr","line_number":5,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/cli/cli.cr#L5"},{"filename":"src/likeer.cr","line_number":6,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer.cr#L6"},{"filename":"src/likeer/downloader.cr","line_number":6,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/downloader.cr#L6"},{"filename":"src/likeer/utils.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/utils.cr#L3"},{"filename":"src/likeer/version.cr","line_number":1,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/version.cr#L1"},{"filename":"src/likeer/video_collector.cr","line_number":3,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/video_collector.cr#L3"}],"repository_name":"Likeer","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"\"0.1.0\"","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[{"id":"download_user_feed(uid:String)-class-method","html_id":"download_user_feed(uid:String)-class-method","name":"download_user_feed","doc":"Iterates through the user - *uid* - profile and download all videos.","summary":"<p>Iterates through the user - <em>uid</em> - profile and download all videos.</p>","abstract":false,"args":[{"name":"uid","doc":null,"default_value":"","external_name":"uid","restriction":"String"}],"args_string":"(uid : String)","args_html":"(uid : String)","location":{"filename":"src/likeer.cr","line_number":8,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer.cr#L8"},"def":{"name":"download_user_feed","args":[{"name":"uid","doc":null,"default_value":"","external_name":"uid","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"VideoCollector.collect_each(uid: uid) do |video|\n  Downloader.download(video: video, directory: uid)\nend"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"Likeer/Likeer/CLI","path":"Likeer/CLI.html","kind":"module","full_name":"Likeer::CLI","name":"CLI","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"src/cli/cli.cr","line_number":7,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/cli/cli.cr#L7"}],"repository_name":"Likeer","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likeer/Likeer","kind":"module","full_name":"Likeer","name":"Likeer"},"doc":"TODO: Refactor","summary":"<p><span class=\"flag orange\">TODO</span>  Refactor</p>","class_methods":[{"id":"config-class-method","html_id":"config-class-method","name":"config","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/cli/cli.cr","line_number":8,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/cli/cli.cr#L8"},"def":{"name":"config","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"Commander::Command.new do |handler|\n  handler.use = \"likeer\"\n  handler.long = \"download videos and their metadata from Likee.\"\n  handler.flags.add do |flag|\n    flag.name = \"fast update\"\n    flag.short = \"-f\"\n    flag.long = \"--fast-update\"\n    flag.default = true\n    flag.description = \"Stop when encountering the first already-downloaded video.\"\n  end\n  handler.commands.add do |cmd|\n    cmd.use = \"store <uid>\"\n    cmd.short = \"Download videos from the user feed.\"\n    cmd.long = cmd.short\n    cmd.run do |_options, arguments|\n      if uid = arguments.first\n      else\n        puts(\"Missing <uid> argument.\")\n        next\n      end\n      Log.info do\n        \"Likeer is running (v#{VERSION})\"\n      end\n      elapsed_time = Time.measure do\n        Likeer.download_user_feed(uid: uid)\n      end\n      Log.info do\n        \"Finished in #{elapsed_time.to_i} seconds\"\n      end\n    end\n  end\n  handler.run do |_options, _arguments|\n    puts(handler.help)\n  end\nend"}},{"id":"run(argv)-class-method","html_id":"run(argv)-class-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[{"name":"argv","doc":null,"default_value":"","external_name":"argv","restriction":""}],"args_string":"(argv)","args_html":"(argv)","location":{"filename":"src/cli/cli.cr","line_number":47,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/cli/cli.cr#L47"},"def":{"name":"run","args":[{"name":"argv","doc":null,"default_value":"","external_name":"argv","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"Commander.run(config, ARGV)"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"Likeer/Likeer/Downloader","path":"Likeer/Downloader.html","kind":"class","full_name":"Likeer::Downloader","name":"Downloader","abstract":false,"superclass":{"html_id":"Likeer/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Likeer/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Likeer/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/likeer/downloader.cr","line_number":7,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/downloader.cr#L7"}],"repository_name":"Likeer","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"Log","name":"Log","value":"::Log.for(\"Downloader\")","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likeer/Likeer","kind":"module","full_name":"Likeer","name":"Likeer"},"doc":null,"summary":null,"class_methods":[{"id":"download(video:Likee::Video,directory:String):Bool-class-method","html_id":"download(video:Likee::Video,directory:String):Bool-class-method","name":"download","doc":"Instantiates a `Downloader` and call `#download`.","summary":"<p>Instantiates a <code><a href=\"../Likeer/Downloader.html\">Downloader</a></code> and call <code><a href=\"../Likeer/Downloader.html#download:Bool-instance-method\">#download</a></code>.</p>","abstract":false,"args":[{"name":"video","doc":null,"default_value":"","external_name":"video","restriction":"Likee::Video"},{"name":"directory","doc":null,"default_value":"","external_name":"directory","restriction":"String"}],"args_string":"(video : Likee::Video, directory : String) : Bool","args_html":"(video : Likee::Video, directory : String) : Bool","location":{"filename":"src/likeer/downloader.cr","line_number":11,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/downloader.cr#L11"},"def":{"name":"download","args":[{"name":"video","doc":null,"default_value":"","external_name":"video","restriction":"Likee::Video"},{"name":"directory","doc":null,"default_value":"","external_name":"directory","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Bool","visibility":"Public","body":"(new(video, directory)).download"}}],"constructors":[{"id":"new(video:Likee::Video,directory:String)-class-method","html_id":"new(video:Likee::Video,directory:String)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"video","doc":null,"default_value":"","external_name":"video","restriction":"Likee::Video"},{"name":"directory","doc":null,"default_value":"","external_name":"directory","restriction":"String"}],"args_string":"(video : Likee::Video, directory : String)","args_html":"(video : Likee::Video, directory : String)","location":{"filename":"src/likeer/downloader.cr","line_number":15,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/downloader.cr#L15"},"def":{"name":"new","args":[{"name":"video","doc":null,"default_value":"","external_name":"video","restriction":"Likee::Video"},{"name":"directory","doc":null,"default_value":"","external_name":"directory","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(video, directory)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"download:Bool-instance-method","html_id":"download:Bool-instance-method","name":"download","doc":"Downloads a `Likee::Video`. The video is initially saved to a temporary\nfile, then it's moved to its definitive location.","summary":"<p>Downloads a <code>Likee::Video</code>.</p>","abstract":false,"args":[],"args_string":" : Bool","args_html":" : Bool","location":{"filename":"src/likeer/downloader.cr","line_number":21,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/downloader.cr#L21"},"def":{"name":"download","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Bool","visibility":"Public","body":"if File.exists?(filename)\n  Log.info do\n    \"#{@video.id} already archived; skipping\"\n  end\n  return true\nend\nbegin\n  Utils.retry_on_connection_error do\n    HTTP::Client.get(@video.download_url, headers: headers) do |response|\n      if response.success?\n      else\n        raise(Likee::Client::ClientError.new(response.status))\n      end\n      File.write(temp_filename, response.body_io)\n    end\n  end\nrescue ex\n  Log.error do\n    \"Retries exausted: #{@video.download_url}; skipping\"\n  end\n  return false\nend\nFileUtils.mv(temp_filename, filename)\nLog.info do\n  \"#{@video.id} has been successfully archived\"\nend\ntrue\n"}}],"macros":[],"types":[]},{"html_id":"Likeer/Likeer/Utils","path":"Likeer/Utils.html","kind":"module","full_name":"Likeer::Utils","name":"Utils","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"src/likeer/utils.cr","line_number":5,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/utils.cr#L5"}],"repository_name":"Likeer","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likeer/Likeer","kind":"module","full_name":"Likeer","name":"Likeer"},"doc":"The `Utils` module defines multiple helpers.","summary":"<p>The <code><a href=\"../Likeer/Utils.html\">Utils</a></code> module defines multiple helpers.</p>","class_methods":[{"id":"retry_on_connection_error(&)-class-method","html_id":"retry_on_connection_error(&)-class-method","name":"retry_on_connection_error","doc":"Retries the *&block* when a connection error or a Likee API error occurs.","summary":"<p>Retries the <em>&block</em> when a connection error or a Likee API error occurs.</p>","abstract":false,"args":[],"args_string":"(&)","args_html":"(&)","location":{"filename":"src/likeer/utils.cr","line_number":7,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/utils.cr#L7"},"def":{"name":"retry_on_connection_error","args":[],"double_splat":null,"splat_index":null,"yields":0,"block_arg":null,"return_type":"","visibility":"Public","body":"on_retry_callback = ->(_ex : Exception, attempt : Int32, _elapsed_time : Time::Span, _next_interval : Time::Span) do\n  Log.error do\n    \"An error occoured while fetching posts; retring (#{attempt}/5)...\"\n  end\nend\nRetriable.retry(on: {IO::TimeoutError, Errno::ECONNRESET, Likee::Client::ClientError}, on_retry: on_retry_callback, intervals: Array.new(5, 2.seconds)) do\n  yield\nend\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"Likeer/Likeer/VideoCollector","path":"Likeer/VideoCollector.html","kind":"module","full_name":"Likeer::VideoCollector","name":"VideoCollector","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"src/likeer/video_collector.cr","line_number":6,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/video_collector.cr#L6"}],"repository_name":"Likeer","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"Log","name":"Log","value":"::Log.for(\"VideoCollector\")","doc":null,"summary":null},{"id":"MAX_VIDEOS_PER_PAGE","name":"MAX_VIDEOS_PER_PAGE","value":"100","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likeer/Likeer","kind":"module","full_name":"Likeer","name":"Likeer"},"doc":"The `VideoCollector` module defines the interaction with the Likee API\nto fetch videos from the user profile.","summary":"<p>The <code><a href=\"../Likeer/VideoCollector.html\">VideoCollector</a></code> module defines the interaction with the Likee API to fetch videos from the user profile.</p>","class_methods":[{"id":"collect_each(uid:String,last_post_id:String=&quot;&quot;,&)-class-method","html_id":"collect_each(uid:String,last_post_id:String=&quot;&quot;,&)-class-method","name":"collect_each","doc":"Yields each video from the user profile. It iterates through all pages\nfrom the newest video to the oldest video.","summary":"<p>Yields each video from the user profile.</p>","abstract":false,"args":[{"name":"uid","doc":null,"default_value":"","external_name":"uid","restriction":"String"},{"name":"last_post_id","doc":null,"default_value":"\"\"","external_name":"last_post_id","restriction":"String"}],"args_string":"(uid : String, last_post_id : String = <span class=\"s\">&quot;&quot;</span>, &)","args_html":"(uid : String, last_post_id : String = <span class=\"s\">&quot;&quot;</span>, &)","location":{"filename":"src/likeer/video_collector.cr","line_number":13,"url":"https://github.com/kandayo/likee-scraper/blob/74977ad54c2eff705b1b423865e7603a531fdc8d/src/likeer/video_collector.cr#L13"},"def":{"name":"collect_each","args":[{"name":"uid","doc":null,"default_value":"","external_name":"uid","restriction":"String"},{"name":"last_post_id","doc":null,"default_value":"\"\"","external_name":"last_post_id","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":null,"return_type":"","visibility":"Public","body":"loop do\n  Log.info do\n    \"API Call uid:#{uid} last_post_id:#{last_post_id}\"\n  end\n  collection = Utils.retry_on_connection_error do\n    Likee.get_user_video(uid: uid, last_post_id: last_post_id, count: MAX_VIDEOS_PER_PAGE)\n  end\n  if collection.videos.empty?\n    break\n  end\n  last_post_id = collection.last_post_id.to_s\n  collection.videos.each do |video|\n    yield video\n  end\nend"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]}]}]}}